<!-- start custom footer snippets -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
      // Get baseurl from Jekyll (make sure _config.yml is properly configured)
      const baseurl = "{{ site.baseurl }}";
      
      function replaceCustomEmojis() {
        // Use baseurl in path construction
        const emojiDir = `${baseurl}/assets/images/emoji/`;
        const regex = /:([a-zA-Z0-9_+-]+):/g;
    
        // Replace innerHTML safely
        walkDOM(document.body, function(node) {
          if (node.nodeType === Node.TEXT_NODE) {
            node.textContent = node.textContent.replace(regex, (match, shortcode) => {
              return `<img src="${emojiDir}${shortcode}.webp" alt="${shortcode}" class="emoji">`;
            });
          }
        });
      }
    
      // Safer DOM traversal than innerHTML replacement
      function walkDOM(node, callback) {
        if (node.nodeType === Node.TEXT_NODE) {
          callback(node);
        } else {
          node.childNodes.forEach(child => walkDOM(child, callback));
        }
      }
    
      replaceCustomEmojis();
    });
    </script>
<!-- end custom footer snippets -->